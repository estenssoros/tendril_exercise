{% extends 'songs/base_site.html' %}
{% load static %}
{% load songs_extras %}
{% block head %}
<script src="http://cdn.pydata.org/bokeh/release/bokeh-0.12.5.min.js"></script>
<link rel="stylesheet" href="http://cdn.pydata.org/bokeh/release/bokeh-0.12.5.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>
{% endblock %}

{% block content %}
<p>
  <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseExample1" aria-expanded="false" aria-controls="collapseExample">
    Descriptive Statistics
  </button>
  <button class="btn btn-success" type="button" data-toggle="collapse" data-target="#collapseExample2" aria-expanded="false" aria-controls="collapseExample">
    Correlation Matrix
  </button>
</p>
<div class="collapse" id="collapseExample1">
  <div class="card card-block">
    <div class="panel panel-primary">
      <div class="panel-heading">Descriptive Statistics</div>
      <div class="panel-body">
        <div class="table-responsive">
          {{ desc|safe }}
        </div>
      </div>
    </div>
  </div>
</div>
<div class="collapse" id="collapseExample2">
  <div class="card card-block">
    <div class="panel panel-success">
      <div class="panel-heading">Correlation Matrix</div>
      <div class="panel-body">
        <div class="table-responsive">
          {{ corr|safe }}
        </div>
        <div class="col-md-3">
          <h2>Plot!</h2>
          <div class="well">
            <div class="form-group row">
              <label class="mr-sm-2" for="x_axis">X axis </label>
              <select class="custom-select mb-2 mr-sm-2 mb-sm-0" id="x_axis">
            <option selected>Choose...</option>
            {%for field in fields%}
            <option value="{{field}}">{{field|make_title}}</option>
            {%endfor%}
          </select>
            </div>
            <div class="form-group row">
              <label class="mr-sm-2" for="y_axis">Y axis </label>
              <select class="custom-select mb-2 mr-sm-2 mb-sm-0" id="y_axis">
            <option selected>Choose...</option>
            {%for field in fields reversed%}
            <option value="{{field}}">{{field|make_title}}</option>
            {%endfor%}
          </select>
            </div>
          </div>
        </div>
        <div class="col-sm-6">
          <canvas id="myChart1" width="400" height="400"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>
<hr>
<div class="row">
  <div class="col-md-4">
    <canvas id="myChart2" width="400" height="400"></canvas>
  </div>
  <div class="col-md-4">
  <canvas id="myChart3" width="400" height="400"></canvas>
  </div>
</div>
{% endblock %}
{%block scripts%}
{%endblock%}
{% block jquery %}

$("select").change(function() {
  xAxis = $('#x_axis :selected').val();
  yAxis = $('#y_axis :selected').val();
  var endpoint = '/songs/api/chart/';
  var defaultData = [];
  $.ajax({
    method: "GET",
    url: endpoint,
    data: {
      x_axis: xAxis,
      y_axis: yAxis
    },
    success: function(data) {
      setChart1(data);
    },
    error: function(error_data) {
      console.log("error");
      console.log(error_data);
    }
  });
});

function setChart1(data) {
  var ctx = document.getElementById("myChart1").getContext('2d');
  var myChart = new Chart(ctx, {
    type: 'scatter',
    data: {
      datasets: [{
        data: data.scatter,
        backgroundColor: [
          'rgba(255, 99, 132, 0.2)',
          'rgba(54, 162, 235, 0.2)',
          'rgba(255, 206, 86, 0.2)',
          'rgba(75, 192, 192, 0.2)',
          'rgba(153, 102, 255, 0.2)',
          'rgba(255, 159, 64, 0.2)'
        ],
        borderColor: [
          'rgba(255,99,132,1)',
          'rgba(54, 162, 235, 1)',
          'rgba(255, 206, 86, 1)',
          'rgba(75, 192, 192, 1)',
          'rgba(153, 102, 255, 1)',
          'rgba(255, 159, 64, 1)'
        ],
        borderWidth: 1,
        pointRadius: 1
      }]
    },
    options: {
      showLines: false,
      legend: {
        display: false
      },
      scales: {
        xAxes: [{
          type: 'linear',
          position: 'bottom',
          scaleLabel: {
            display: true,
            labelString: data.x_axis
          }
        }],
        yAxes: [{
          type: 'linear',
          scaleLabel: {
            display: true,
            labelString: data.y_axis
          }
        }]
      },
      title:{
        display:true,
        fontSize:24,
        text:data.title
      }

    }
  });
};

$.ajax({
  method: "GET",
  url: "/songs/api/plot_api/",
  data :{
    chart_type: 'song_count_by_year'
  },
  success: function(data){
    setChart2(data);
  },
  error: function(error_data){
    console.log('error');
    console.log(error_data);
  }
});

function setChart2(data){
  var ctx = document.getElementById("myChart2");
  var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels : data.labels,
        datasets: [{
            data: data.values,
            backgroundColor : 'rgba(255, 99, 132, 0.2)',
            borderColor: 'rgba(255,99,132,1)',
            borderWidth: 1
        }]
    },
    options: {
      legend: {
        display: false
      },
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero:true
                }
            }]
        }
    }
});
};

$.ajax({
  method: "GET",
  url: "/songs/api/plot_api/",
  data :{
    chart_type: 'featured_count_by_year'
  },
  success: function(data){
    setChart3(data);
  },
  error: function(error_data){
    console.log('error');
    console.log(error_data);
  }
});
function setChart3(data){
  var ctx = document.getElementById("myChart3");
  var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels : data.labels,
        datasets: [{
            data: data.values,
            backgroundColor : 'rgba(54, 162, 235, 0.2)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
        }]
    },
    options: {
      legend: {
        display: false
      },
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero:true
                }
            }]
        }
    }
});
};
{% endblock %}
